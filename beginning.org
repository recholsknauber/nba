* Use Python to pull NBA data
** Python code for data pull
   #+name: nba_data_import
   #+begin_src python
     import pandas as pd
     from nba_data_pull import get_nba_team_stats

     nba_data_import_2011 = get_nba_team_stats (2011)
     nba_data_import_2011.head()
     nba_data_import_2011.to_csv("~/data/nba-data/nba_teams_2012.csv", index=True)
   #+end_src

* Clojure Data Manipulation
** Import NBA csv to Clojure, formatting into a sequence of maps.
https://github.com/clojure/data.csv
   #+begin_src clojure
     (require '[clojure.data.csv :as csv]
	      '[clojure.java.io :as io])

     (def whole-numbers (iterate inc 1))

     (defn csv-data-sort-columns [csv-data seq-maps]
       (sorted-map-by (get #(zipmap (map keyword (first csv-data) whole-numbers))) seq-maps))
                       
     ;; Convert CSV data to maps
     (defn csv-data->maps [csv-data]
       (csv-data-sor(map zipmap
	    (->> (first csv-data) ;; First row is the header
		 (map keyword) ;; Drop if you want string keys instead
		 repeat)
	    (rest csv-data)))

     (def nba_team_stats_2011
       (with-open [reader (io/reader "/home/recholsknauber/data/nba-data/nba_teams_2012.csv")]
	 (doall
	  (let [data (csv/read-csv reader)]
	    (csv-data->maps data)))))
   #+end_src

   #+RESULTS:
   : nil#'nba.core/csv-data->maps#'nba.core/nba_team_stats_2011

** Start Oz server (throws error on browser open, but is correctly running on local port.)
   #+begin_src clojure
     (require '[oz.core :as oz])
     (oz/start-server!)
     ;; http://localhost:10666/
   #+end_src
** Visualizing Mavs
   #+begin_src clojure
     (filter #(= (:TEAM_NAME %) "Mavericks") nba_team_stats_2011)

     (defn play-data [& names]
       (for [n names
	     i (range 20)]
	     {:time i :item n :quantity (+ (Math/pow (* i (count n)) 0.8) (rand-int (count n)))}))

     (def line-plot
       {:data {:values (play-data "monkey" "slipper" "broom")}
	:encoding {:x {:field "time" :type "quantitative"}
		   :y {:field "quantity" :type "quantitative"}
		   :color {:field "item" :type "nominal"}}
	:mark "line"})

     ;; Render the plot
     (oz/view! line-plot)
   #+end_src
